"use strict";var picker=angular.module("kirin-daterangepicker",["moment"]);picker.value("dateRangePickerConfig",{seperator:" - ",format:"YYYY/MM/DD"}),picker.directive("dateRangePicker",["$compile","$timeout","$parse","dateRangePickerConfig",function($compile,$timeout,$parse,dateRangePickerConfig){return{require:"ngModel",restrict:"A",scope:{dateMin:"=min",dateMax:"=max",opts:"=options"},template:function(element,attrs){var defaultsAttrs={};for(var xx in defaultsAttrs)void 0===attrs[xx]&&(attrs[xx]=defaultsAttrs[xx]);var html="<div>";return html+="</div>"},link:function($scope,element,attrs,modelCtrl){var customOpts,el,opts,_formatted,_init,_picker,_validateMax,_validateMin;return el=$(element),customOpts=$parse(attrs.dateRangePicker)($scope,{}),opts=angular.extend({},dateRangePickerConfig,customOpts),_picker=null,_formatted=function(viewVal){var f;return f=function(date){return moment.isMoment(date)?date.format(opts.format):moment(date).format(opts.format)},opts.singleDatePicker?f(viewVal.startDate):[f(viewVal.startDate),f(viewVal.endDate)].join(opts.separator)},_validateMin=function(min,start){var valid;return min=moment(min),start=moment(start),valid=min.isBefore(start)||min.isSame(start,"day"),modelCtrl.$setValidity("min",valid),valid},_validateMax=function(max,end){var valid;return max=moment(max),end=moment(end),valid=max.isAfter(end)||max.isSame(end,"day"),modelCtrl.$setValidity("max",valid),valid},modelCtrl.$formatters.push(function(val){return val&&val.startDate&&val.endDate?(_picker.setStartDate(val.startDate),_picker.setEndDate(val.endDate),val):""}),modelCtrl.$parsers.push(function(val){return angular.isObject(val)&&val.hasOwnProperty("startDate")&&val.hasOwnProperty("endDate")?($scope.dateMin&&val.startDate?_validateMin($scope.dateMin,val.startDate):modelCtrl.$setValidity("min",!0),$scope.dateMax&&val.endDate?_validateMax($scope.dateMax,val.endDate):modelCtrl.$setValidity("max",!0),val):modelCtrl.$modelValue}),modelCtrl.$isEmpty=function(val){return!val||null===val.startDate||null===val.endDate},modelCtrl.$render=function(){return el.val(modelCtrl.$modelValue?null===modelCtrl.$modelValue.startDate?"":_formatted(modelCtrl.$modelValue):"")},_init=function(){return el.daterangepicker(opts,function(start,end,label){return $timeout(function(){return $scope.$apply(function(){return modelCtrl.$setViewValue({startDate:start.toDate(),endDate:end.toDate()}),modelCtrl.$render()})})}),_picker=el.data("daterangepicker"),el},_init(),el.change(function(){return""===$.trim(el.val())?$timeout(function(){return $scope.$apply(function(){return modelCtrl.$setViewValue({startDate:null,endDate:null})})}):void 0}),attrs.min&&$scope.$watch("dateMin",function(date){return date?(modelCtrl.$isEmpty(modelCtrl.$modelValue)||_validateMin(date,modelCtrl.$modelValue.startDate),opts.minDate=moment(date)):opts.minDate=!1,_init()}),attrs.max&&$scope.$watch("dateMax",function(date){return date?(modelCtrl.$isEmpty(modelCtrl.$modelValue)||_validateMax(date,modelCtrl.$modelValue.endDate),opts.maxDate=moment(date)):opts.maxDate=!1,_init()}),attrs.options&&$scope.$watch("opts",function(newOpts){return opts=angular.extend(opts,newOpts),_init()}),$scope.$on("$destroy",function(){return _picker.remove()})},controller:function($scope,$element,$attrs){}}}]);